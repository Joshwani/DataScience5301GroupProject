---
title: "dtsc_5301_final_project"
---

# Data Science for Finance

## Introduction

Exchange Traded Funds (ETFs) have become a popular investment vehicle over the past few years. In this noteboo, we compare the performance of two portfolios: an equally weighted portfolio and a portfolio whose weights are determined by a bubble indicator.

| ETF Ticker                                                                              | Allocation | Underlying Asset | Description                                                                                                                                                                   |
|:--------------|:--------------|:--------------|:--------------------------|
| [VTI](https://investor.vanguard.com/etf/profile/VTI)                                    | 20%        | Equity           | Seeks to track the performance of the CRSP US Total Market Index. Large- mid- and small-cap equity diversified across growth and value styles.                                |
| [VTV](https://investor.vanguard.com/etf/profile/VTV)                                    | 20%        | Equity           | Seeks to track the performance of the CRSP US Large Cap Value Index which measures the investment return of large-capitalization value stocks.                                |
| [VBR](https://investor.vanguard.com/etf/profile/VBR)                                    | 20%        | Equity           | Seeks to track the performance of the CRSP US Small Cap Value Index which measures the investment return of small-capitalization value stocks.                                |
| [TLT](https://www.ishares.com/us/products/239454/ishares-20-year-treasury-bond-etf)     | 20%        | Debt             | The iShares 20+ Year Treasury Bond ETF seeks to track the investment results of an index composed of U.S. Treasury bonds with remaining maturities greater than twenty years. |
| [AGG](https://www.ishares.com/us/products/239458/ishares-core-total-us-bond-market-etf) | 20%        | Debt             | The iShares Core U.S. Aggregate Bond ETF seeks to track the investment results of an index composed of the total U.S. investment-grade bond market.                           |

Since the equally weighted portfolio represents 60% equities and 40% debt a fair benchmark could be 60% VTI (Total Equity Market) and 40% AGG (Total Bond Market). This benchmark is created in the **Organizing Data Building Benchmark & Portfolio Determining Cumulative Returns** section.

## General Imports and Constants

```{r}
install.packages('tidyverse')
install.packages('dplyr')
library('ggplot2')
library('dplyr')
POS_BUBBLE_THRESHOLD = 0.08
NEG_BUBBLE_THRESHOLD = 0.02
```

## Fetching Universe Data (Yahoo! Finance)

Yahoo! Finance computes an Adjusted Closing price that factors in all splits and dividends. https://help.yahoo.com/kb/SLN28256.html Here we are simply loading the datasets that were previously fetched from Yahoo! Finance.

```{r}
# read universe.csv into df var
df <- read.csv('data/universe.csv')

# create a 60/40 portfolio
df$Benchmark <- apply(df[2:6], 1, mean)

ggplot(df, aes(x=as.Date(Date))) + geom_line(aes(y=Benchmark))
```

## Organizing Data, Building Benchmark & Portfolio, Determining Cumulative Returns

```{r}
# stuff
```

## Bubble Model

Is it possible to avoid the large drawdowns discovered in the drawdown analysis? Here we use the [Log-Periodic Power Law Singularity (LPPLS) Model](https://en.wikipedia.org/wiki/Didier_Sornette#The_JLS_and_LPPLS_models). It describes a bubble as a faster-than-exponential increase in asset price that reflects positive feedback loop of higher return anticipations competing with negative feedback spirals of crash expectations. A bubble has a distinct signature that resembles a power law with a finite-time singularity decorated by oscillations with a frequency increasing with time.

If we can identify bubbles in an equity benchmark, perhaps we could use that as a signal to weight our portfolio more heavily towards the less risky debt assets (AGG and TLT).

The first step is to compute the bubble indicators for the benchmark. Here I'm going to find bubbles in the VTI instrument, since it is total market.

### Load Bubble Data

```{r}
bubble_df<- read.csv('data/confidence.csv')
bubble_df
```

### Visualize Bubble Data

```{r}
ggplot(bubble_df, aes(x=as.Date(time))) + geom_line(aes(y=price)) + geom_line(aes(y=pos_conf, color='green')) + geom_line(aes(y=neg_conf*-1, color='red'))
```

## Construct Bubble Portfolio

```{r}
# TODO join data frames. df + bubble df on date

bubble_df$conf = bubble_df$pos_conf - bubble_df$neg_conf

bubble_df %>% mutate(BubblePortfolio = case_when(
  conf >= POS_BUBBLE_THRESHOLD ~ 'Risk Off', 
  conf <= -NEG_BUBBLE_THRESHOLD ~ 'Risk On',
  -NEG_BUBBLE_THRESHOLD < conf & conf < POS_BUBBLE_THRESHOLD ~ 'Equal Weight'
))
bubble_df
```
